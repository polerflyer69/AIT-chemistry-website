{% extends "base.html" %}
{% block title %}Student Results{% endblock %}
{% block content %}
<section class="section" style="padding-top: 120px;">
    <div class="container" style="max-width: 800px;">

        {% if not student %}

        <div class="login-card" style="max-width: 500px;"> <!-- Reuse login card style but slightly wider -->
            <div style="margin-bottom: 1.5rem; display: flex; justify-content: center;">
                <div
                    style="width: 60px; height: 60px; background: #e0f2fe; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #0284c7; font-size: 1.5rem; box-shadow: 0 4px 10px rgba(2, 132, 199, 0.1);">
                    üîç
                </div>
            </div>

            <h2 style="color: #1e3a8a; margin-bottom: 2rem;">Check Your Result</h2>

            <form method="POST" style="margin-top: 1rem;">
                <div style="text-align: left;">
                    <label
                        style="color: #475569; font-weight: 600; margin-bottom: 0.6rem; display: block; font-size: 0.9rem;">Search
                        Criteria</label>
                    <input type="text" name="identifier" placeholder="Enter Roll No or Phone (e.g. AIT001)" required
                        style="width: 100%;">
                </div>

                <button type="submit" class="nav-btn"
                    style="width: 100%; padding: 1rem; margin-top: 0.5rem; font-size: 1rem; box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.4);">View
                    Results</button>
            </form>

            {% if error %}
            <div
                style="background: #fef2f2; color: #b91c1c; padding: 0.8rem; border-radius: 12px; margin-top: 1.5rem; font-size: 0.9rem; border: 1px solid #fecaca; display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
                <span>‚ö†Ô∏è</span> {{ error }}
            </div>
            {% endif %}

            <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(0,0,0,0.05);">
                <p style="color: #64748b; font-size: 0.9rem;">
                    Already have a student account? <br>
                    <a href="{{ url_for('login') }}"
                        style="color: #2563eb; font-weight: 600; text-decoration: none;">Login here</a> to view
                    dashboard.
                </p>
            </div>
        </div>
        {% else %}
        <div style="text-align: right; margin-bottom: 1rem;">
            <a href="{{ url_for('logout') }}" class="nav-btn" style="background-color: #ef4444;">Logout</a>
        </div>
        {% endif %}

        {% if student %}
        <div class="glass-card">
            <h3>Student: {{ student['full_name'] }} <span style="font-size: 0.8em; opacity: 0.7;">({{
                    student['class_batch'] }})</span></h3>

            {% if results %}
            <table
                style="width: 100%; border-collapse: collapse; margin-top: 1rem; background: rgba(255,255,255,0.5); border-radius: 8px; overflow: hidden;">
                <thead style="background: rgba(0,0,0,0.1);">
                    <tr>
                        <th style="padding: 1rem; text-align: left;">Test Name</th>
                        <th style="padding: 1rem;">Date</th>
                        <th style="padding: 1rem;">Marks</th>
                        <th style="padding: 1rem;">Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for res in results %}
                    <tr style="border-bottom: 1px solid rgba(0,0,0,0.05); color: #0f172a;">
                        <td style="padding: 1rem;">{{ res['test_name'] }}</td>
                        <td style="padding: 1rem; text-align: center;">{{ res['test_date'] }}</td>
                        <td style="padding: 1rem; text-align: center;"><b>{{ res['marks_obtained'] }}</b> / {{
                            res['total_marks'] }}</td>
                        <td style="padding: 1rem; text-align: center;">
                            {{ (res['marks_obtained'] / res['total_marks'] * 100) | round(1) }}%
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No results found for this student yet.</p>
            {% endif %}
        </div>
        {% endif %}

    </div>
</section>
{% endblock %}